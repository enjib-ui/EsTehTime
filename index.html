<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Catatan Penjualan EsTehTime</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0; padding: 30px; min-height: 100vh;
    display: flex; justify-content: center; align-items: center;
    background: 
      linear-gradient(rgba(255, 255, 255, 0.5), rgba(126, 151, 166, 0.5)),
      url('background.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    backdrop-filter: blur(1px);
  }

  #lihatDataBtn {
  position: fixed;
  top: 20px;
  right: 20px;
  background: rgba(126, 151, 166, 0.85);
  color: #fff;
  border: none;
  border-radius: 8px;
  font-weight: 600;
  font-size: 0.95em;
  padding: 8px 14px; /* üîπ menyesuaikan panjang teks */
  cursor: pointer;
  backdrop-filter: blur(5px);
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
  transition: background 0.3s ease, transform 0.2s ease;
  z-index: 999; /* üîπ pastikan selalu di atas elemen lain */
  width: auto;
  min-width: unset;
}
#lihatDataBtn:hover {
  background: rgba(106, 130, 145, 0.95);
  transform: translateY(-1px);
}
#lihatDataBtn:active {
  transform:translateY(0);
}
  .card-container {
    background-color: rgba(255,255,255,0.2);
    padding: 40px;
    border-radius: 16px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    max-width: 450px;
    width: 100%;
    border: 1px solid rgba(255,255,255,0.4);
    text-align: center;
    backdrop-filter: blur(10px);
    transition: all 0.3s ease;
  }

  .logo { width:80px; height:80px; object-fit:contain; margin-bottom:1px; }
  h2 { color:#333; margin:0 0 20px 0; font-weight:600; line-height:1.2; }

  label { display:block; text-align:left; margin-bottom:6px; font-weight:500; color:#555; font-size:0.95em; }

  input[type="date"], input[type="text"] {
    width:100%; padding:12px; margin-bottom:25px; border:1px solid #D1D9E6;
    border-radius:8px; font-size:1em; color:#333;
    transition:border-color 0.3s; background-color:#fff;
  }
  input:focus {
    border-color:#A8DADC; outline:none;
    box-shadow:0 0 0 2px rgba(168,218,220,0.4);
  }

  .rupiah-input-group {
    position: relative;
    display: flex;
    align-items: center;
  }
  .rupiah-prefix {
    position: absolute;
    left: 12px;
    color: #555;
    font-weight: 600;
    pointer-events: none;
    font-size: 1em;
  }
  input#nominal { padding-left: 40px; height: 45px; line-height: 45px; }

  button {
    background-color:#7E97A6; color:white;
    padding:12px 20px; border:none;
    border-radius:8px; cursor:pointer; width:100%;
    font-size:1.05em; font-weight:600;
    transition:background-color 0.3s ease, transform 0.2s ease;
  }
  button:hover { background-color:#6A8291; transform:translateY(-1px); }

  .preview-card {
    display:none;
    background:#ffffffd9;
    border:1px solid #E0E0E0;
    border-radius:10px;
    padding:20px;
    text-align:left;
    margin-top:15px;
  }
  .preview-card h3 { margin-top:0; color:#333; }
  .preview-card p { margin:8px 0; color:#444; font-size:1em; }

  .btn-group { display:flex; gap:10px; margin-top:15px; }
  .btn-edit { background-color:#f0ad4e; }
  .btn-resend { background-color:#5cb85c; }
  .btn-edit:hover { background-color:#e39c41; }
  .btn-resend:hover { background-color:#4cae4c; }

  /* Tombol WhatsApp di bawah catatan */
  #btn-wa {
    margin-top: 15px;
    background-color: #25D366;
  }
  #btn-wa:hover {
    background-color: #1ebe5d;
  }
</style>
</head>
<body>
  
<button id="lihatDataBtn">Lihat Data</button>

<div class="card-container">
  <img src="logo.png" alt="Logo Toko" class="logo">
  <h2>Catatan Penjualan</h2>
  
  <form id="sales-form">
    <div>
      <label for="tanggal">üóìÔ∏è Tanggal Penjualan:</label>
      <input type="date" id="tanggal" name="tanggal" required>
    </div>

    <div>
      <label for="nominal">üí∞ Nominal Penjualan:</label>
      <div class="rupiah-input-group">
        <span class="rupiah-prefix">Rp</span>
        <input type="text" id="nominal" name="nominal" placeholder="Masukkan Nominal Penjualan..." required>
      </div>
    </div>
    <div>
  <label>üí∏ Pengeluaran:</label>

  <div class="rupiah-input-group" style="margin-bottom:10px">
    <span class="rupiah-prefix">Rp</span>
    <input
      type="text"
      id="pengeluaran"
      placeholder="Nominal Pengeluaran..."
    >
  </div>

  <input
    type="text"
    id="keterangan"
    placeholder="Keterangan Pengeluaran (contoh: gula, es, dll)"
  >
</div>

    <button type="submit">Simpan Catatan</button>
  </form>

  <div class="preview-card" id="preview-card">
    <h3>üìã Catatan Tersimpan</h3>
    <p><strong>Tanggal:</strong> <span id="preview-tanggal"></span></p>
    <p><strong>Nominal:</strong> <span id="preview-nominal"></span></p>
    <p>
  <strong>Pengeluaran:</strong>
  <span id="preview-pengeluaran"></span>
</p>
<p>
  <strong>Keterangan:</strong>
  <span id="preview-keterangan"></span>
</p>

    <div class="btn-group">
      <button class="btn-edit" id="btn-edit">Edit</button>
      <button class="btn-resend" id="btn-resend">Kirim Ulang</button>
    </div>

    <!-- ‚úÖ Tombol WhatsApp -->
    <button id="btn-wa">Kirim ke WhatsApp</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAv2KN1pHrUPTMaNL2bXF39NI8S2iN2TWw",
  authDomain: "estehtime.firebaseapp.com",
  projectId: "estehtime",
  storageBucket: "estehtime.firebasestorage.app",
  messagingSenderId: "185336920733",
  appId: "1:185336920733:web:b0d09bdc8724ac80763274"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const form = document.getElementById('sales-form');
const tanggalInput = document.getElementById('tanggal');
const nominalInput = document.getElementById('nominal');
const previewCard = document.getElementById('preview-card');
const previewTanggal = document.getElementById('preview-tanggal');
const previewNominal = document.getElementById('preview-nominal');
const btnEdit = document.getElementById('btn-edit');
const btnResend = document.getElementById('btn-resend');
const btnWA = document.getElementById('btn-wa');
const lihatDataBtn = document.getElementById('lihatDataBtn');
const pengeluaranInput = document.getElementById('pengeluaran');
const keteranganInput = document.getElementById('keterangan');
const previewPengeluaran = document.getElementById('preview-pengeluaran');
const previewKeterangan = document.getElementById('preview-keterangan');



// tombol lihat data
lihatDataBtn.addEventListener('click', () => {
  window.location.href = 'login.html';
});

// set tanggal hari ini
const tanggalHariIni = new Date().toISOString().split('T')[0];
tanggalInput.value = tanggalHariIni;

// format input nominal
nominalInput.addEventListener('input', () => {
  let value = nominalInput.value.replace(/\D/g,'');
  nominalInput.value = value ? new Intl.NumberFormat('id-ID').format(value) : '';
});
  pengeluaranInput.addEventListener('input', () => {
  let value = pengeluaranInput.value.replace(/\D/g,'');
  pengeluaranInput.value = value
    ? new Intl.NumberFormat('id-ID').format(value)
    : '';
});

// load data hari ini
window.addEventListener('load', async () => {
  try {
    const docRef = doc(db, "penjualan", tanggalHariIni);
    const snap = await getDoc(docRef);
    if (snap.exists()) {
      const data = snap.data();
      previewTanggal.textContent = data.tanggal || tanggalHariIni;
      previewNominal.textContent = "Rp " + new Intl.NumberFormat('id-ID').format(data.nominal || 0);
      previewCard.style.display = 'block';
      form.style.display = 'none';
    }
  } catch (err) {
    console.error("Gagal memuat data:", err);
  }
});

// simpan data
form.addEventListener('submit', async (e) => {
  e.preventDefault();
  const tanggal = tanggalInput.value;
  const nominal = parseInt(nominalInput.value.replace(/\D/g,''));
  if (!tanggal || !nominal) return alert("Isi semua kolom dulu!");

  try {
   const pengeluaranNominal = parseInt(
  pengeluaranInput.value.replace(/\D/g,'')
) || 0;

const keterangan = keteranganInput.value || "";

await setDoc(doc(db, "penjualan", tanggal), {
  tanggal,
  nominal,
  pengeluaran: {
    nominal: pengeluaranNominal,
    keterangan: keterangan
  },
  updatedAt: new Date()
}, { merge: true });


    previewTanggal.textContent = tanggal;
    previewNominal.textContent = "Rp " + new Intl.NumberFormat('id-ID').format(nominal);
    previewCard.style.display = 'block';
    form.style.display = 'none';

    alert("‚úÖ Data berhasil disimpan!");
  } catch (err) {
    alert("‚ùå Gagal menyimpan data: " + err.message);
  }
});

// edit data
btnEdit.addEventListener('click', () => {
  form.style.display = 'block';
  previewCard.style.display = 'none';
});

// kirim ulang
btnResend.addEventListener('click', async () => {
  const tanggal = previewTanggal.textContent;
  const nominal = parseInt(nominalInput.value.replace(/\D/g,''));
  if (!nominal) return alert("Isi nominal dulu!");

  try {
    await setDoc(doc(db, "penjualan", tanggal), {
      tanggal, nominal, updatedAt: new Date()
    }, { merge: true });

    previewNominal.textContent = "Rp " + new Intl.NumberFormat('id-ID').format(nominal);
    alert("‚úÖ Data diperbarui!");
  } catch (err) {
    alert("‚ùå Gagal memperbarui data: " + err.message);
  }
});

// ‚úÖ kirim ke WhatsApp
btnWA.addEventListener('click', () => {
  const tanggal = previewTanggal.textContent;
  const nominal = previewNominal.textContent.replace("Rp ", "");
  const pesan = `Penjualan hari ini ${nominal} Kak (Tanggal ${tanggal})`;
  const nomorWA = "6282337279096"; // ganti nomor tujuan Anda
  const url = `https://wa.me/${nomorWA}?text=${encodeURIComponent(pesan)}`;
  window.open(url, '_blank');
});
</script>
</body>
  </html>
  
